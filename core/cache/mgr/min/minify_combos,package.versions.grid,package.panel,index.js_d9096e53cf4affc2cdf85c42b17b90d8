MODx.combo.Provider=function(config){config=config||{};Ext.applyIf(config,{name:'provider',hiddenName:'provider',url:MODx.config.connector_url,baseParams:{action:'workspace/providers/getList',combo:true},editable:false,pageSize:20});MODx.combo.Provider.superclass.constructor.call(this,config);};Ext.extend(MODx.combo.Provider,MODx.combo.ComboBox);Ext.reg('modx-combo-provider',MODx.combo.Provider);MODx.combo.Workspace=function(config){config=config||{};Ext.applyIf(config,{name:'workspace',hiddenName:'workspace',url:MODx.config.connector_url,baseParams:{action:'workspace/getlist'},editable:false,pageSize:20});MODx.combo.Workspace.superclass.constructor.call(this,config);};Ext.extend(MODx.combo.Workspace,MODx.combo.ComboBox);Ext.reg('modx-combo-workspace',MODx.combo.Workspace);;MODx.grid.PackageVersions=function(config){config=config||{};this.exp=new Ext.grid.RowExpander({tpl:new Ext.Template('<p class="package-readme"><i>{readme}</i></p>')});Ext.applyIf(config,{title:_('packages'),id:'modx-grid-package-versions',url:MODx.config.connector_url,baseParams:{action:'workspace/packages/version/getList',signature:config.signature},fields:['signature','name','version','release','created','updated','installed','state','workspace','provider','provider_name','disabled','source','readme','menu'],plugins:[this.exp],pageSize:20,columns:[this.exp,{header:_('name'),dataIndex:'name'},{header:_('version'),dataIndex:'version'},{header:_('release'),dataIndex:'release'},{header:_('installed'),dataIndex:'installed',renderer:this._rins},{header:_('provider'),dataIndex:'provider_name',editable:false}],primaryKey:'signature',paging:true,autosave:true});MODx.grid.PackageVersions.superclass.constructor.call(this,config);};Ext.extend(MODx.grid.PackageVersions,MODx.grid.Grid,{_rins:function(d,c){switch(d){case'':case null:c.css='not-installed';return _('not_installed');default:c.css='';return d;}},removePriorVersion:function(btn,e){var r=this.menu.record;MODx.msg.confirm({title:_('package_version_remove'),text:_('package_version_remove_confirm'),url:this.config.url,params:{action:'workspace/packages/version/remove',signature:r.signature},listeners:{'success':{fn:function(){if(this.fireEvent('afterRemoveRow',r)){this.removeActiveRow(r);}},scope:this}}});}});Ext.reg('modx-grid-package-versions',MODx.grid.PackageVersions);;MODx.panel.Package=function(config){config=config||{};Ext.applyIf(config,{url:MODx.config.connector_url,baseParams:{},id:'modx-panel-package',cls:'container',chunk:'',bodyStyle:'',items:[{html:'<h2>'+_('package')+'</h2>',border:false,cls:'modx-page-header',id:'modx-package-header'},MODx.getPageStructure([{title:_('package'),defaults:{border:false,msgTarget:'side'},layout:'form',id:'modx-package-form',labelWidth:150,items:[{xtype:'panel',border:false,cls:'main-wrapper',layout:'form',items:[{xtype:'statictextfield',fieldLabel:_('package'),name:'package_name',width:300},{xtype:'statictextfield',fieldLabel:_('signature'),name:'signature',width:300,submitValue:true},{xtype:'statictextfield',fieldLabel:_('uploaded_on'),name:'created',width:300},{xtype:'statictextfield',fieldLabel:_('installed'),name:'installed',width:300},{xtype:'statictextfield',fieldLabel:_('last_updated'),name:'updated',width:300},{xtype:'modx-combo-provider',fieldLabel:_('provider'),name:'provider',width:300},{xtype:'textarea',readOnly:true,fieldLabel:_('readme'),name:'readme',width:'80%',height:200},{xtype:'textarea',readOnly:true,fieldLabel:_('license'),name:'license',width:'80%',height:200},{xtype:'textarea',readOnly:true,fieldLabel:_('changelog'),name:'changelog',width:'80%',height:200}]}]},{title:_('uploaded_versions'),defaults:{border:false,msgTarget:'side'},items:[{xtype:'modx-grid-package-versions',cls:'main-wrapper',signature:config.signature,preventRender:true}]}])],listeners:{'setup':{fn:this.setup,scope:this},'success':{fn:this.success,scope:this},'beforeSubmit':{fn:this.beforeSubmit,scope:this}}});MODx.panel.Package.superclass.constructor.call(this,config);};Ext.extend(MODx.panel.Package,MODx.FormPanel,{initialized:false,setup:function(){if(this.config.signature===''||this.config.signature===0||this.initialized){this.fireEvent('ready');return false;}
MODx.Ajax.request({url:this.config.url,params:{action:'workspace/packages/get',signature:this.config.signature},listeners:{'success':{fn:function(r){this.getForm().setValues(r.object);Ext.getCmp('modx-package-header').getEl().update('<h2>'+_('package')+': '+r.object.package_name+'</h2>');this.fireEvent('ready',r.object);this.initialized=true;},scope:this}}});},beforeSubmit:function(o){return this.fireEvent('save',{values:this.getForm().getValues()});},success:function(r){}});Ext.reg('modx-panel-package',MODx.panel.Package);;MODx.page.Package=function(config){config=config||{};Ext.applyIf(config,{formpanel:'modx-panel-package',components:[{xtype:'modx-panel-package',signature:MODx.request.signature}],buttons:[{process:'workspace/packages/update',text:_('save'),id:'modx-abtn-save',cls:'primary-button',method:'remote',keys:[{key:MODx.config.keymap_save||'s',alt:true,ctrl:true}]},{process:'cancel',text:_('cancel'),id:'modx-abtn-cancel',handler:function(){MODx.loadPage('workspaces');}},{text:_('help_ex'),id:'modx-abtn-help',handler:MODx.loadHelpPane}]});MODx.page.Package.superclass.constructor.call(this,config);};Ext.extend(MODx.page.Package,MODx.Component);Ext.reg('modx-page-package',MODx.page.Package);